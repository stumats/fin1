["function _c647eaf1dfa9571f564ec845100d554422752ae7",50,567020,"ux.OfflineSync",605774,38,"trackLocalSync:true,autoServerSync:true,localProxy:null,serverProxy:null},statics:{CREATED:\"created\",UPDATED:\"updated\",REMOVED:\"removed\"}",297568,33,"this.callParent([a])},loadLocal:function(a,b){this._proxy=this.getLocalProxy();this.load(a,b,true)},loadServer:function(a,b){this._proxy=this.getServerProxy();this.on({load:{fn:this.onServerLoad,single:true,scope:this}});this.load(a,b,true)},sync:function(){this._proxy=this.getLocalProxy();var d=this.callParent(arguments);var c=d.added,a=d.updated,b=d.removed;if(this.getTrackLocalSync()){if(c.length>0){this.storeCreated(c)}if(a.length>0){this.storeUpdated(a)}if(b.length>0){this.storeRemoved(b)}if(this.doAutoServerSync()){this.syncServer()}}return d},syncServer:function(){this._proxy=this.getServerProxy();var e=this,b={},f=e.getModifiedRecordsCollection(Ext.ux.OfflineSyncStore.CREATED),d=e.getModifiedRecordsCollection(Ext.ux.OfflineSyncStore.UPDATED),a=e.getRemovedRecordsCollection(Ext.ux.OfflineSyncStore.REMOVED),g=false;if(f.length>0){for(var c=0;c<f.length;c++){f[c].data[this.getModel().getIdProperty()]=f[c].id}",428227,152,428389,46,428442,39,"storeCreated:function(a){this.storeChanged(a,Ext.ux.OfflineSyncStore.CREATED,false)},storeUpdated:function(d){var g=this.getModifiedCollection(Ext.ux.OfflineSyncStore.CREATED),e=[],k=[],a=false,h",345185,32,";for(var c=0;c<d.length;c++){var f=d[c];for(var b=0;b<g.length;b++){if(f.data[h]===g[b][h]){a=true;break}}if(a){e.push(f.data)}else{k.push(f)}}this.storeChanged(this.mergeOrReplaceArrays(g,e),Ext.ux.OfflineSyncStore.CREATED,true);this.storeChanged(k,Ext.ux.OfflineSyncStore.UPDATED,false)},storeRemoved:function(f){var g=this.getModifiedCollection(Ext.ux.OfflineSyncStore.CREATED),e=this.getModifiedCollection(Ext.ux.OfflineSyncStore.UPDATED),l=[],m=false,h",345185,32,";for(var d=0;d<f.length;d++){var c=f[d];for(var b=0;b<g.length;b++){if(c.data[h]===g[b][h]){m=true;g.splice(b,1);break}}for(var a=0;a<e.length;a++){if(c.data[h]===e[a][h]){e.splice(a,1);break}}if(!m){l.push(c)}}this.storeChanged(g,Ext.ux.OfflineSyncStore.CREATED,true);this.storeChanged(e,Ext.ux.OfflineSyncStore.UPDATED,true);this.storeChanged(l,Ext.ux.OfflineSyncStore.REMOVED,false)},storeChanged:function(e,j,a){var f=this.getLocalProxy().getId()+\"-\"+j,g=[];for(var c=0;c<e.length;c++){var b=e[c].isModel?e[c].data:e[c];g.push(b)}var h=localStorage.getItem(f),d=!Ext.isEmpty(h)?Ext.decode(h):[];if(!a){g=this.mergeOrReplaceArrays(d,g)}localStorage.removeItem(f);localStorage.setItem(f,Ext.encode(g)",430337,35,"this.callParent(arguments);if(c&&!this.isLocalMode()){this.clearModifiedCollection(Ext.ux.OfflineSyncStore.CREATED)}",430372,34,"this.callParent(arguments);if(c&&!this.isLocalMode()){this.clearModifiedCollection(Ext.ux.OfflineSyncStore.UPDATED)}",430406,40,"callParent(arguments);if(c&&!this.isLocalMode()){this.clearModifiedCollection(Ext.ux.OfflineSyncStore.REMOVED)}},clearModifiedCollection:function(a){localStorage.removeItem(this.getLocalProxy().getId()+\"-\"+a)},getModifiedCollection:function(b){var c=localStorage.getItem(this.getLocalProxy().getId()+\"-\"+b),a=!Ext.isEmpty(c)?Ext.decode(c):[];return a},getModifiedRecordsCollection:function(d){var e=this.getModifiedCollection(d),b=[];for(var c=0;c<e.length;c++){var a=this.getById(e[c][this.getModel().getIdProperty()]);if(a){b.push(a)}}return b},getRemovedRecordsCollection:function(d){var e=this.getModifiedCollection(d),b=[];for(var c=0;c<e.length;c++){var a=this.getModel().create(e[c]);if(a){b.push(a)}}return b},onServerLoad:function(b,a,c){if(c){this._proxy=this.getLocalProxy();this._proxy.clear();b.each(function(d){d.setDirty(true)});this.disableTrackLocalSync();this.sync();b.each(function(d){d.commit()});this.enableTrackLocalSync()}else{this.loadLocal()}},isLocalMode:function(){return this.getProxy()===this.getLocalProxy()},disableTrackLocalSync:function(){this.setTrackLocalSync(false)},enableTrackLocalSync:function(){this.setTrackLocalSync(true)},hasPendingServerSync:function(){return this.hasPendingCreated()||this.hasPendingUpdated()||this.hasPendingRemoved()},hasPendingCreated:function(){return this.getModifiedCollection(Ext.ux.OfflineSyncStore.CREATED).length>0},hasPendingUpdated:function(){return this.getModifiedCollection(Ext.ux.OfflineSyncStore.UPDATED).length>0},hasPendingRemoved:function(){return this.getModifiedCollection(Ext.ux.OfflineSyncStore.REMOVED).length>0},doAutoServerSync:function(){var a=this.getAutoServerSync();if(Ext.isFunction(a)){a=a.call(this)}return a},applyServerProxy:function(b,a){return this.applyProxy(b,a)},updateServerProxy:function(a){this.updateProxy(a)},applyLocalProxy:function(b,a){return this.applyProxy(b,a)},updateLocalProxy:function(a){this.updateProxy(a)},mergeOrReplaceArrays:function(g,f,b){var e=0,c=g.length,a=f.length,h=false;b=b||this.getModel().getIdProperty();for(;e<c;e++){for(var d=0;d<a;d++){if(g[e][b]===f[d][b]){h=true;break}}if(!h){f.push(g[e])}h=false}return f}",567051,23311,"model.serverMarker",589466,72,589871,644,"road",590533,218,"Click the icon to add notes or change the type. Double-click it to delete it.<br /><br />The Fault List page shows a list of all faults and clicking on each shows a streetview and a static map with marker.<br /",590793,122,590959,237,"Add\"},{scrollable:\"vertical\",",591201,57,"50,height:50,margin:\"4px 4px 0 0px",591281,53,"5",591335,74,"5",591410,79,"5",591490,78,"5",591569,83,"5",591653,96,"5",591750,210,"false,mapOptions:{zoom:16",592024,484,",\"<br /><strong>Click for streetview, map etc</strong>\"",593872,33,592541,410,592945,92,"database (limited by cross-site json issue)",593047,675,",placeholder:\"required",593721,56,",placeholder:\"required - any valid",593768,607,"F",594382,238,"}})",597133,33,594825,724,";geo.updateLocation(",595548,32,595597,72,"checkLocError=0;",595980,33,595702,314,"if(",595513,37,596016,379,"d",596396,49,"uselocation=c[0].get(\"uselocation\");name",596480,236,"uselocation",596717,305,"name",597023,779,597824,35,597879,572,598466,132,";getInfoWindow()});if(",595513,36,";geo.updateLocation()}}});var mapMarkers=[];getInfoWindow=function(){",598626,39,"};var toolbarClick=function(g,a){if(typeof currentLat==\"undefined\"||typeof currentLng==\"undefined\"){if(checkLocError!=1){Ext.Msg.alert(\"Problem\",\"Location cannot be determined now\")}var b=a.getMap().getCenter();var h=b.lat();var i=b.lng();checkLocError=1}else{var h=currentLat;var i=currentLng}var d=addMarker(g,a.getMap(),h,i",598763,107,"e",598871,49,"g,markerLat:h,markerLng:i",598945,103,"j=e.validate();var c=\"\";if(!j.isValid()){j.each(function(l){c+=l.getField()+\" : \"+l",599131,42,"c)}else{var k=Ext.getStore(\"markers\");var f=k.add(e);d.mID=f[0].getId();d.details=\"\";mapMarkers.push(d",599275,32,"d,\"dragend\",function(m){var n=k.findExact(\"id\",d.mID);var l=k.findRecord(\"id\",d.mID);l.set(\"markerLat\",m.latLng.lat().toFixed(7));l.set(\"markerLng\",m.latLng.lng().toFixed(7));k.sync()});k.sync()}};",599508,255,599832,89,599999,881,"if(typeof currentLat==\"undefined\"||typeof currentLng==\"undefined\"){if(checkLocError!=1){Ext.Msg.alert(\"Problem\",\"Location cannot be determined\")}checkLocError=1}else{",600897,35,"currentLat,currentLng))}",599277,34,"blclick\",function(){",601059,260,"dragend\",function(k){var m=Ext.getStore(\"markers\");var l=m.findExact(\"id\",c.mID);var j=m.findRecord(\"id\",c.mID);j.set(\"markerLat\",k.latLng.lat().toFixed(7));j.set(\"markerLng\",k.latLng.lng().toFixed(7));m.sync()}",599275,35,"click\",function(){",601378,855,602237,314,597134,32,602604,1496,604116,449,604566,76,"view\",iconCls:\"maps",605304,61,604723,39,"Latitude: {markerLat}</div>\",\"<div>Longitude",604799,409,"Map\",iconCls:\"maps",605231,69,"maps",605304,813,"define(\"maptest1.store.serverMarkers\",{extend:Ext.ux.OfflineSync",605798,36,"serverMarkers\",storeId:\"smarkers\",autoSync:true,autoLoad:true,autoServerSync:true,localProxy:{type:\"localstorage\",id:\"offline-sync-store\"},serverProxy:{type:\"ajax\",url:\"http://hybridweb.co.nz/chair/maptest2/json/markers.php?action=readmarkers\",api:{read:\"http://hybridweb.co.nz/chair/maptest2/json/markers.php?action=readmarkers\",create:\"http://hybridweb.co.nz/chair/maptest2/json/markers.php?action=createmarker\"},reader:{type:\"json\",rootProperty:\"markers\"},writer:{allowSingle:false}}},initialize:function(){this.loadLocal()",606109,250,",\"server",606351,48,",\"serverMarkers",606398,773]