["function _c047bb8d30b0d2f17dfc423016d3bf2bc92f95da",50,436331,"JsonP",245577,32,"JSONP\",singleton:true,requestCount:0,requests:{},timeout:30000",272158,47,"callbackKey:\"callback\",request:function(m){m=Ext.apply({},m);var i=this,d=Ext.isDefined(m.disableCaching)?m.disableCaching:i.disableCaching,g=m.disableCachingParam||i.disableCachingParam,c=++i.requestCount,k=m.callbackName||\"callback\"+c,h=m.callbackKey||i.callbackKey,l=Ext.isDefined(m.timeout)?m.timeout:i.timeout,e=Ext.apply({},m.params),b=m.url,a=Ext.isSandboxed?Ext.getUniqueGlobalNamespace():\"Ext\",f,j;e[h]=a+\".data.JsonP.\"+k;if(d){e[g]=new Date().getTime()}j=i.createScript(b,e,m);i.requests[c]=f={url:b,params:e,script:j,id:c,scope:m.scope,success:m.success,failure:m.failure,callback:m.callback,callbackKey:h,callbackName:k};if(l>0){f.timeout=setTimeout(Ext.bind(i.handleTimeout,i,[f]),l)}i.setupErrorHandling(f);i[k]=Ext.bind(i.handleResponse,i,[f],true);i.loadScript(f);return f},abort:function(b){var c=this.requests,a;if(b){if(!b.id){b=c[b]}this.handleAbort(b)}else{",107485,36,"this.abort(c[a])}}}},setupErrorHandling:function(a){a.script.onerror=Ext.bind(this.handleError,this,[a])},handleAbort:function(a){a.errorType=\"abort\";this.handleResponse(null,a)},handleError:function(a){a.errorType=\"error\";this.handleResponse(null,a)},cleanupErrorHandling:function(a){a.script.onerror=null},handleTimeout:function(a){a.errorType=\"timeout\";this.handleResponse(null,a)},handleResponse:function(a,b){var c=true;if(b.timeout){clearTimeout(b.timeout)}delete this[b.callbackName];delete this.requests[b.id];this.cleanupErrorHandling(b);Ext.fly(b.script).destroy();if(b.errorType){c=false;Ext.callback(b.failure,b.scope,[b.errorType,b])}else{",276295,37,"}",276333,33,"c,a,b.errorType,b])},createScript:function(c,d,b){var a",48313,33,";a.setAttribute(\"src\",Ext.urlAppend(c,Ext.Object.toQueryString(d)));a.setAttribute(\"async\",true);a.setAttribute(\"type\",\"text/javascript\");return a},loadScript:function(a){Ext.getHead().appendChild(a.script)",384373,36,436392,1650,"JsonP",388750,34,"ternateClassName:\"Ext.data.ScriptTagProxy\",alias:[\"proxy.jsonp\",\"proxy.scripttag\"],config:{defaultWriterType:\"base\",callbackKey:\"callback\",recordParam:\"records\",autoAppendParams:true",389027,39,"c=d.buildRequest(a),e=c.getParams();c.setConfig({callbackKey:d.getCallbackKey(),timeout:d.getTimeout(),scope:d",389182,42,"});if(d.getAutoAppendParams()){c.setParams({})}c.setJsonP(Ext.data.JsonP.request(c.getCurrentConfig()));c.setParams(e);a.setStarted();d.lastRequest=c;return c",389559,69,"h,f,g){delete c.lastRequest;",389635,32,",setException:function(b,a){b.setException(b.getRequest().getJsonP().errorType)},buildUrl:function(f){var e=this,a=e.callParent(arguments),h=Ext.apply({},f.getParams()),d=h.filters,c,b,g;delete h.filters;if(e.getAutoAppendParams()){a=Ext.urlAppend(a,Ext.Object.toQueryString(h))}if(d&&d.length){for(b=0;b<d.length;b++){c=d[b];g=c.getValue();if(g){a=Ext.urlAppend(a,c.getProperty()+\"=\"+g)}}",284298,35,"abort",362418,32,"bort:function(){var a=this.lastRequest;if(a){Ext.data.JsonP.abort(a.getJsonP())}}",438012,125685,"ux.OfflineSync",595040,38,"trackLocalSync:true,autoServerSync:true,localProxy:null,serverProxy:null},statics:{CREATED:\"created\",UPDATED:\"updated\",REMOVED:\"removed\"}",297568,33,"this.callParent([a])},loadLocal:function(a,b){this._proxy=this.getLocalProxy();this.load(a,b,true)},loadServer:function(a,b){this._proxy=this.getServerProxy();this.on({load:{fn:this.onServerLoad,single:true,scope:this}});this.load(a,b,true)},sync:function(){this._proxy=this.getLocalProxy();var d=this.callParent(arguments);var c=d.added,a=d.updated,b=d.removed;if(this.getTrackLocalSync()){if(c.length>0){this.storeCreated(c)}if(a.length>0){this.storeUpdated(a)}if(b.length>0){this.storeRemoved(b)}if(this.doAutoServerSync()){this.syncServer()}}return d},syncServer:function(){this._proxy=this.getServerProxy();var e=this,b={},f=e.getModifiedRecordsCollection(Ext.ux.OfflineSyncStore.CREATED),d=e.getModifiedRecordsCollection(Ext.ux.OfflineSyncStore.UPDATED),a=e.getRemovedRecordsCollection(Ext.ux.OfflineSyncStore.REMOVED),g=false;if(f.length>0){for(var c=0;c<f.length;c++){f[c].data[this.getModel().getIdProperty()]=f[c].id}",428227,152,428389,46,428442,39,"storeCreated:function(a){this.storeChanged(a,Ext.ux.OfflineSyncStore.CREATED,false)},storeUpdated:function(d){var g=this.getModifiedCollection(Ext.ux.OfflineSyncStore.CREATED),e=[],k=[],a=false,h",345185,32,";for(var c=0;c<d.length;c++){var f=d[c];for(var b=0;b<g.length;b++){if(f.data[h]===g[b][h]){a=true;break}}if(a){e.push(f.data)}else{k.push(f)}}this.storeChanged(this.mergeOrReplaceArrays(g,e),Ext.ux.OfflineSyncStore.CREATED,true);this.storeChanged(k,Ext.ux.OfflineSyncStore.UPDATED,false)},storeRemoved:function(f){var g=this.getModifiedCollection(Ext.ux.OfflineSyncStore.CREATED),e=this.getModifiedCollection(Ext.ux.OfflineSyncStore.UPDATED),l=[],m=false,h",345185,32,";for(var d=0;d<f.length;d++){var c=f[d];for(var b=0;b<g.length;b++){if(c.data[h]===g[b][h]){m=true;g.splice(b,1);break}}for(var a=0;a<e.length;a++){if(c.data[h]===e[a][h]){e.splice(a,1);break}}if(!m){l.push(c)}}this.storeChanged(g,Ext.ux.OfflineSyncStore.CREATED,true);this.storeChanged(e,Ext.ux.OfflineSyncStore.UPDATED,true);this.storeChanged(l,Ext.ux.OfflineSyncStore.REMOVED,false)},storeChanged:function(e,j,a){var f=this.getLocalProxy().getId()+\"-\"+j,g=[];for(var c=0;c<e.length;c++){var b=e[c].isModel?e[c].data:e[c];g.push(b)}var h=localStorage.getItem(f),d=!Ext.isEmpty(h)?Ext.decode(h):[];if(!a){g=this.mergeOrReplaceArrays(d,g)}localStorage.removeItem(f);localStorage.setItem(f,Ext.encode(g)",430337,35,"this.callParent(arguments);if(c&&!this.isLocalMode()){this.clearModifiedCollection(Ext.ux.OfflineSyncStore.CREATED)}",430372,34,"this.callParent(arguments);if(c&&!this.isLocalMode()){this.clearModifiedCollection(Ext.ux.OfflineSyncStore.UPDATED)}",430406,40,"callParent(arguments);if(c&&!this.isLocalMode()){this.clearModifiedCollection(Ext.ux.OfflineSyncStore.REMOVED)}},clearModifiedCollection:function(a){localStorage.removeItem(this.getLocalProxy().getId()+\"-\"+a)},getModifiedCollection:function(b){var c=localStorage.getItem(this.getLocalProxy().getId()+\"-\"+b),a=!Ext.isEmpty(c)?Ext.decode(c):[];return a},getModifiedRecordsCollection:function(d){var e=this.getModifiedCollection(d),b=[];for(var c=0;c<e.length;c++){var a=this.getById(e[c][this.getModel().getIdProperty()]);if(a){b.push(a)}}return b},getRemovedRecordsCollection:function(d){var e=this.getModifiedCollection(d),b=[];for(var c=0;c<e.length;c++){var a=this.getModel().create(e[c]);if(a){b.push(a)}}return b},onServerLoad:function(b,a,c){if(c){this._proxy=this.getLocalProxy();this._proxy.clear();b.each(function(d){d.setDirty(true)});this.disableTrackLocalSync();this.sync();b.each(function(d){d.commit()});this.enableTrackLocalSync()}else{this.loadLocal()}},isLocalMode:function(){return this.getProxy()===this.getLocalProxy()},disableTrackLocalSync:function(){this.setTrackLocalSync(false)},enableTrackLocalSync:function(){this.setTrackLocalSync(true)},hasPendingServerSync:function(){return this.hasPendingCreated()||this.hasPendingUpdated()||this.hasPendingRemoved()},hasPendingCreated:function(){return this.getModifiedCollection(Ext.ux.OfflineSyncStore.CREATED).length>0},hasPendingUpdated:function(){return this.getModifiedCollection(Ext.ux.OfflineSyncStore.UPDATED).length>0},hasPendingRemoved:function(){return this.getModifiedCollection(Ext.ux.OfflineSyncStore.REMOVED).length>0},doAutoServerSync:function(){var a=this.getAutoServerSync();if(Ext.isFunction(a)){a=a.call(this)}return a},applyServerProxy:function(b,a){return this.applyProxy(b,a)},updateServerProxy:function(a){this.updateProxy(a)},applyLocalProxy:function(b,a){return this.applyProxy(b,a)},updateLocalProxy:function(a){this.updateProxy(a)},mergeOrReplaceArrays:function(g,f,b){var e=0,c=g.length,a=f.length,h=false;b=b||this.getModel().getIdProperty();for(;e<c;e++){for(var d=0;d<a;d++){if(g[e][b]===f[d][b]){h=true;break}}if(!h){f.push(g[e])}h=false}return f}",563678,23311,"model.serverMarker",586093,72,586498,553,"itemId:\"intro\",",587051,76,"road",587145,218,"Click the icon to add notes or change the type. Double-click it to delete it.<br /><br />The Fault List page shows a list of all faults and clicking on each shows a streetview and a static map with marker.<br /",587405,122,589764,111,587682,126,"\"},{scrollable:\"vertical\",",587813,57,"50,height:50,margin:\"4px 4px 0 0px",587894,53,"5",587948,74,"5",588023,79,"5",588103,78,"5",588182,83,"5",588266,96,"5",588363,210,"false,mapOptions:{zoom:16",588637,484,",\"<br /><strong>Click for streetview, map etc</strong>",589120,444,589558,92,"database (limited by cross-site json issue)",589660,1121,"itemId:\"mapandtool",590778,189,"F",590974,238,591381,139,"introView:\"#intro",591518,508,"if(b.hideintro){this.hideIntro()}else{this.showIntro()}if(b.uselocation){geo.setAutoUpdate(true);geo.updateLocation()}else{geo.setAutoUpdate(false)}}},launch:function(a){checkLocError=0;",592201,33,592131,32,"email)==\"undefined\"",592096,35,"\"settingspanel\");return false}",592153,36,592190,44,"2);this.getIntroView().hide();this.getMainView().getTabBar().getAt(0).hide(",592235,43,"if(uselocation){geo.setAutoUpdate(true)}},showIntro:function(){this.getIntroView().show();this.getMainView().getTabBar().getAt(0).show()},hideIntro:function(){this.getIntroView().hide();this.getMainView().getTabBar().getAt(0).hide()",592278,187,"d",592466,49,"uselocation=c[0].get(\"uselocation\");name",592550,236,"uselocation)",592880,85,"0);geo.setAutoUpdate(false",592874,93,";geo.setAutoUpdate(true)}",592607,41,593009,34,"name);",592607,41,593087,89,"controller.mapControl",326397,37,591469,51,"mapView:\"mappanel\",mapBtn1:\"#map-it-btn\",mapBtn2:\"#map-it-btn2\",myMap:'map[id=\"stumap\"]',fld:\"#flood-btn\",treefall:\"#treefall-btn\",pothole:\"#pothole-btn\",lightout:\"#lightout-btn\",lightbroken:\"#lightbroken-btn\",trafficlightbroken:\"#trafficlightbroken-btn\"},control:{mapView:{maprender:\"onRenderMap\"},fld:{tap:\"onFloodTap\"},treefall:{tap:\"onTreefallTap\"},pothole:{tap:\"onPotholeTap\"},lightout:{tap:\"onLightoutTap\"},lightbroken:{tap:\"onLightbrokenTap\"},trafficlightbroken:{tap:\"onTrafficlightbrokenTap\"}}},launch:function(){this.callParent()},init:function(){this.callParent()},onFloodTap:function(){toolbarClick(\"flood\",this.getMyMap())},onTreefallTap:function(){toolbarClick(\"treefall\",this.getMyMap())},onPotholeTap:function(){toolbarClick(\"pothole\",this.getMyMap())},onLightoutTap:function(){toolbarClick(\"lightout\",this.getMyMap())},onLightbrokenTap:function(){toolbarClick(\"lightbroken\",this.getMyMap())},onTrafficlightbrokenTap:function(){toolbarClick(\"trafficlightbroken\",this.getMyMap())},onRenderMap:function(d,c,b){var a=Ext.getStore(\"markers\");a.load();a.each(function(g){var e=new google.maps.LatLng(g.data.markerLat,g.data.markerLng);var f=addMarker(g.data.markerType,c,g.data.markerLat,g.data.markerLng);f.mID=g.data.id;f.details=g.data.markerTxt;mapMarkers.push(f);getInfoWindow()});if(uselocation){geo.setAutoUpdate(true);geo.updateLocation()}}});var mapMarkers=[];getInfoWindow=function(){infowindow=new google.maps.InfoWindow()};var toolbarClick=function(g,a){if(typeof currentLat==\"undefined\"||typeof currentLng==\"undefined\"){if(checkLocError!=1){Ext.Msg.alert(\"Problem\",\"Location cannot be determined now\")}var b=a.getMap().getCenter();var h=b.lat();var i=b.lng();checkLocError=1}else{var h=currentLat;var i=currentLng}var d=addMarker(g,a.getMap(),h,i);settingsName=(typeof name!=\"undefined\")?name:\"-\";settingsEmail=(typeof email!=\"undefined\")?email:\"-\";var e=Ext.create(\"maptest1.model.Markers\",{markerType:g,markerLat:h,markerLng:i,markerTxt:\"some text\",markerPic:\"pic src\",name:settingsName,email:settingsEmail,date:new Date()});var j=e.validate();var c=\"\";if(!j.isValid()){j.each(function(l){c+=l.getField()+\" : \"+l",591902,42,"c)}else{var k=Ext.getStore(\"markers\");var f=k.add(e);d.mID=f[0].getId();d.details=\"\";mapMarkers.push(d);google.maps.event.addListener(d,\"dragend\",function(m){var n=k.findExact(\"id\",d.mID);var l=k.findRecord(\"id\",d.mID);l.set(\"markerLat\",m.latLng.lat().toFixed(7));l.set(\"markerLng\",m.latLng.lng().toFixed(7));k.sync()});k.sync()}};updateMarkerData=function(){var j=Ext.getStore(\"markers\");var f=j.findRecord(\"id\",document.getElementById(\"mID\").value);var d=document.getElementById(\"mID\").value;var a=document.getElementById(\"details\").value;var c=document.getElementById(\"mType\").value;f.set(\"markerTxt\",a);f.set(\"markerType\",c);j.sync();for(var e=0;e<mapMarkers.length;e++){if(mapMarkers[e].mID==d){var h=mapMarkers.indexOf(mapMarkers[e]);var b=mapMarkers[h].mID;break}}var g=\"resources/mapicons/\"+c+\"_icon.png\";mapMarkers[h].setIcon(g);mapMarkers[h].details=a;infowindow.close()};var addMarker=function(f,a,g,i){var e=loSel=tfSel=lbSel=fSel=tlbSel=\"\";switch(f){case\"pothole\":e=\"SELECTED\";break;case\"lightout\":loSel=\"SELECTED\";break;case\"treefall\":tfSel=\"SELECTED\";break;case\"lightbroken\":lbSel=\"SELECTED\";break;case\"flood\":fSel=\"SELECTED\";break;case\"trafficlightbroken\":tlbSel=\"SELECTED\";break}var d={url:\"resources/mapicons/\"+f+\"_icon.png\",size:new google.maps.Size(30,42),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(30,42)};var h=new google.maps.LatLng(g,i);var b=a.getCenter();var c=new google.maps.Marker({position:h,title:f,draggable:true,map:a,icon:d",591287,37,"});if(typeof currentLat==\"undefined\"||typeof currentLng==\"undefined\"){if(checkLocError!=1){Ext.Msg.alert(\"Problem\",\"Location cannot be determined\")}checkLocError=1}else{a.setCenter(new google.maps.LatLng(currentLat,currentLng))}google.maps.event.addListener(c,\"dblclick\",function(){if(confirm(\"Deselect \"+c.title+\" and remove from Map?\")){c.setMap(null);for(var k=0;k<mapMarkers.length;k++){if(mapMarkers[k].getPosition().equals(c.getPosition())){var j=mapMarkers.indexOf(c);mapMarkers.splice(j,1);break}}}});google.maps.event.addListener(c,\"dragend\",function(k){var m=Ext.getStore(\"markers\");var l=m.findExact(\"id\",c.mID);var j=m.findRecord(\"id\",c.mID);j.set(\"markerLat\",k.latLng.lat().toFixed(7));j.set(\"markerLng\",k.latLng.lng().toFixed(7));m.sync()});google.maps.event.addListener(c,\"click\",function(){var k=(typeof c.details!=\"undefined\")?c.details:\"Enter any notes/details\";var j='<table><tr><td>Details:</td> <td><textarea rows=\"3\" cols=\"30\" id=\\'details\\' onfocus=\"this.value=\\'\\';\"/>'+k+\"</textarea> </td> </tr><tr><td></td> <td><input type='hidden' id='mID' value='\"+c.mID+\"' /></td> </tr><tr><td>Change fault:</td> <td><select id='mType'><option value='pothole' \"+e+\">Pothole</option><option value='lightout' \"+loSel+\">Light out</option><option value='treefall' \"+tfSel+\">Tree down</option><option value='lightbroken' \"+lbSel+\">Broken light</option><option value='flood' \"+fSel+\">Flood</option><option value='trafficlightbroken' \"+tlbSel+\">Broken traffic light</option></select> </td></tr><tr><td></td><td><input type='button' value='Update' onclick='updateMarkerData()'/></td></tr></table>\";infowindow.setContent(j);infowindow.open(a,c)});return c};geo=Ext.create(\"Ext.util.Geolocation\",{autoUpdate:false,listeners:{locationupdate:function(d){currentLat=d.getLatitude();currentLng=d.getLongitude();var a=d.getAltitude();var b=d.getSpeed();var c=d.getHeading()},locationerror:function(e,a,b,d,c){if(a){alert(\"Timeout occurred.\")}else{alert(\"Error occurred.\")}}",591381,36,"listMarker",591424,53,"rkerdumppanel:\"markerdumppanel\",markerlocalpanel:\"markerlocalpanel\",markerdetailpanel:\"markerdetailpanel\",mapView:\"mappanel\"},control:{markerdumppanel:{itemtap:\"onMarkerItemTap\"},\"markerlocalpanel list\":{itemtap:\"onMarkerLocalItemTap\"}}},slideLeftTransi",561402,36,",onMarkerItemTap:function(b,d,h,a,g,c){this.markerFilter=a.get(\"markerType\");alert(\"dump\");var f=this.getMapView();Ext.Viewport.animateActiveItem(f,this.slideLeftTransition)},onMarkerLocalItemTap:function(c,f,g,d,h,k){if(d){this.details=Ext.creat",593164,37,"title:\"Fault details\"});var j=this.details.child(\"#detailMap\");j.setMapOptions({zoom:14,streetViewControl:true});j.setMapCenter({latitude:d.get(\"markerLat\"),longitude:d.get(\"markerLng\")});var i=new google.maps.LatLng(d.get(\"markerLat\"),d.get(\"markerLng\"));var b=new google.maps.Marker({position:i,title:\"fault\",map:j.getMap()});j.setMapCenter(i);var a=this.details.child(\"#fDetail\").child(\"#info\");a.child(\"#text\").setData(d.data);a.child(\"#extratext\").setData(d.data);a.child(\"#img\").setData(d.data);this.details.child(\"#staticMap\").setData(d.data);this.details.child(\"#streetview\").setData(d.data);this.getMarkerlocalpanel().push(this.details)}",590488,32,593183,183,593382,449,593832,76,"view\",iconCls:\"maps",594570,61,593989,485,"Map\",iconCls:\"maps",594497,69,"maps",594570,813,"define(\"maptest1.store.serverMarkers\",{extend:Ext.ux.OfflineSync",595064,36,"serverMarkers\",storeId:\"smarkers\",autoSync:true,autoLoad:true,autoServerSync:true,localProxy:{type:\"localstorage\",id:\"offline-sync-store\"},serverProxy:{type:\"ajax\",url:\"http://hybridweb.co.nz/chair/maptest2/json/markers.php?action=readmarkers\",api:{read:\"http://hybridweb.co.nz/chair/maptest2/json/markers.php?action=readmarkers\",create:\"http://hybridweb.co.nz/chair/maptest2/json/markers.php?action=createmarker\"},reader:{type:\"json\",rootProperty:\"markers\"},writer:{allowSingle:false}}},initialize:function(){this.loadLocal()",595375,186,",\"mapControl\",\"listMarker",595552,39,",\"server",595583,48,",\"serverMarkers",595630,773]